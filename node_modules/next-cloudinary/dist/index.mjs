import ce,{useState as ge,useCallback as fe}from"react";import ue from"next/image";import{getTransformations as ye}from"@cloudinary-util/util";import{transformationPlugins as Ce}from"@cloudinary-util/url-loader";async function v(e){let{src:a}=e;try{await new Promise((n,i)=>{fetch(a).then(o=>{if(!o.ok){i(o);return}n(o)})})}catch(n){return n.status===423?await v(e):!1}return!0}import{constructCloudinaryUrl as me}from"@cloudinary-util/url-loader";import pe from"next/package.json";var X={name:"next-cloudinary",version:"4.15.0",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup src/index.ts --dts",dev:"tsup src/index.ts --watch --dts",prepublishOnly:"cp ../README.md . && yarn build",postpublish:"rm ./README.md",test:"jest","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" yarn build && cd tests/nextjs-app && yarn build'},dependencies:{"@cloudinary-util/url-loader":"^3.9.1","@cloudinary-util/util":"^2.2.1","@cloudinary/url-gen":"^1.10.1"},devDependencies:{"@babel/core":"^7.19.6","@babel/preset-env":"^7.19.4","@types/jest":"^29.2.0","@types/react":"^18.0.28","@types/react-dom":"^18.0.11","babel-jest":"^29.2.2",dotenv:"^16.0.3",jest:"^29.2.2","jest-environment-jsdom":"^29.2.2","ts-jest":"^29.0.3",tsup:"^6.6.3",typescript:"^4.9.4"},peerDependencies:{next:"^12 || ^13",react:"^17 || ^18"}};var Y="V",K=X.version,z=pe.version;function I(e,a,n){return me({options:e,config:Object.assign({cloud:{cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME}},a),analytics:Object.assign({sdkCode:Y,sdkSemver:K,techVersion:z,feature:""},n)})}function R({loaderOptions:e,imageProps:a,cldOptions:n,cldConfig:i={}}){let o={...a,...n};if(o.width=typeof o.width=="string"?parseInt(o.width):o.width,o.height=typeof o.height=="string"?parseInt(o.height):o.height,typeof(e==null?void 0:e.width)=="number"&&typeof o.width=="number"&&e.width!==o.width){let d=e.width/o.width;o.widthResize=e.width,typeof o.height=="number"&&(o.heightResize=Math.round(o.height*d))}return I(o,i)}var Ie=e=>{let a=["deliveryType","preserveTransformations"];Ce.forEach(({props:t=[]})=>{t.forEach(l=>{if(a.includes(l))throw new Error(`Option ${l} already exists!`);a.push(l)})});let n={alt:e.alt,src:e.src};Object.keys(e).filter(t=>!a.includes(t)).forEach(t=>n[t]=e[t]);let i=Object.keys(n).map(t=>`${t}:${n[t]}`).join(";"),[o,d]=ge(i),s={};if(a.forEach(t=>{e[t]&&(s[t]=e[t]||void 0)}),e.preserveTransformations)try{let t=ye(e.src).map(l=>l.join(","));s.rawTransformations=[...t.flat(),...e.rawTransformations||[]]}catch(t){console.warn(`Failed to preserve transformations: ${t.message}`)}async function m(t){let l=!0;if(typeof e.onError=="function"){let O=e.onError(t);typeof O=="boolean"&&O===!1&&(l=!1)}else typeof e.onError=="boolean"&&e.onError===!1&&(l=!1);if(l===!1)return;let P=t.target;await v({src:P.src})&&d(`${i};${Date.now()}`)}let p=fe(m,[v,i]),r=ue;return"default"in r&&(r=r.default),ce.createElement(r,{key:o,...n,loader:t=>R({loaderOptions:t,imageProps:n,cldOptions:s,cldConfig:e.config}),onError:p})},q=Ie;import y from"react";import he from"next/head";var Oe="summary_large_image",Pe=({excludeTags:e=[],twitterTitle:a,keys:n={},...i})=>{let{alt:o}=i,d={...i,crop:i.crop||"fill",gravity:i.gravity||"center",height:i.height||1254,src:i.src,width:i.width||2400,widthResize:i.width||1200},s=typeof d.width=="string"?parseInt(d.width):d.width,m=typeof d.height=="string"?parseInt(d.height):d.height;typeof m=="number"&&typeof s=="number"&&(m=1200/s*m),s=1200;let p=I({...d,format:i.format||"jpg"}),r=I({...d,format:i.format||"webp"}),t={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...n};return y.createElement(he,null,y.createElement("meta",{key:t["og:image"],property:"og:image",content:p}),y.createElement("meta",{key:t["og:image:secure_url"],property:"og:image:secure_url",content:p}),y.createElement("meta",{key:t["og:image:width"],property:"og:image:width",content:`${s}`}),y.createElement("meta",{key:t["og:image:height"],property:"og:image:height",content:`${m}`}),o&&y.createElement("meta",{key:t["og:image:alt"],property:"og:image:alt",content:o}),!e.includes("twitter:title")&&y.createElement("meta",{key:t["twitter:title"],property:"twitter:title",content:a||" "}),y.createElement("meta",{key:t["twitter:card"],property:"twitter:card",content:Oe}),y.createElement("meta",{key:t["twitter:image"],property:"twitter:image",content:r}))},J=Pe;import T from"react";import H,{useState as $,useEffect as Q,useRef as ee}from"react";import Ue from"next/script";function Z(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Ee=["success","display-changed"],we=({children:e,onClose:a,onError:n,onOpen:i,onUpload:o,options:d,signatureEndpoint:s,uploadPreset:m})=>{let p=ee(),r=ee(),t=!!s,[l,P]=$(void 0),[g,O]=$(void 0),[N,G]=$(!0),U={cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,uploadPreset:m||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,apiKey:process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,...d};t&&(U.uploadSignature=E,U.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),Q(()=>{if(typeof g=="undefined")return;let f=g.event==="success",u=g.event==="display-changed"&&g.info==="hidden";f&&typeof o=="function"&&o(g,r.current),u&&typeof a=="function"&&a(r.current)},[g]),Q(()=>{l&&typeof n=="function"&&n(l,r.current)},[l]);function L(){G(!1),p.current||(p.current=window.cloudinary),Z(()=>{r.current||(r.current=w())})}function E(f,u){if(typeof s=="undefined")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(s,{method:"POST",body:JSON.stringify({paramsToSign:u})}).then(c=>c.json()).then(({signature:c})=>{f(c)})}function w(){var f;return(f=p.current)==null?void 0:f.createUploadWidget(U,(u,c)=>{typeof u!="undefined"&&P(u),Ee.includes(c==null?void 0:c.event)&&O(c)})}function D(){r.current||(r.current=w()),r==null||r.current.open(),typeof i=="function"&&i(r.current)}return H.createElement(H.Fragment,null,typeof e=="function"&&e({cloudinary:p.current,widget:r.current,open:D,results:g,error:l,isLoading:N}),H.createElement(Ue,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://widget.cloudinary.com/v2.0/global/all.js",onLoad:L,onError:f=>console.error(`Failed to load Cloudinary Upload Widget: ${f.message}`)}))},b=we;var xe=({children:e,onClick:a,onError:n,onUpload:i,options:o,signatureEndpoint:d,uploadPreset:s,...m})=>T.createElement(T.Fragment,null,T.createElement(b,{onError:n,onUpload:i,options:o,signatureEndpoint:d,uploadPreset:s},({open:p,isLoading:r})=>{function t(l){l.preventDefault(),p(),typeof a=="function"&&a(l)}return T.createElement("button",{...m,onClick:t,disabled:r},e||"Upload")})),te=xe;import h,{useRef as A}from"react";import _e from"next/script";import Le from"next/head";var ve=e=>{let a=A(Math.ceil(Math.random()*1e5)),{autoPlay:n="never",className:i,colors:o,controls:d=!0,fontFace:s,height:m,id:p,logo:r=!0,loop:t=!1,muted:l=!1,onDataLoad:P,onError:g,onMetadataLoad:O,onPause:N,onPlay:G,onEnded:U,src:L,transformation:E,version:w="1.9.4",quality:D="auto",width:f}=e,u=Array.isArray(E)?E:[E];u.unshift({quality:D});let c=A(),re=A(),M=e.videoRef||re,ie=A(),V=e.playerRef||ie,ne=p||`player-${L.replace("/","-")}-${a.current}`,W="cld-video-player cld-fluid";i&&(W=`${W} ${i}`);let j={error:g,loadeddata:P,loadedmetadata:O,pause:N,play:G,ended:U};function ae(C){let x=j[C.type];typeof x=="function"&&x(de())}function le(){if("cloudinary"in window){c.current=window.cloudinary;let C={};typeof r=="boolean"?C.showLogo=r:typeof r=="object"&&(C={...C,showLogo:!0,logoImageUrl:r.imageUrl,logoOnclickUrl:r.onClickUrl});let x={autoplayMode:n,cloud_name:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,controls:d,fontFace:s||"",loop:t,muted:l,publicId:L,secure:!0,transformation:u,...C};typeof o=="object"&&(x.colors=o),V.current=c.current.videoPlayer(M.current,x),Object.keys(j).forEach(B=>{var F;typeof j[B]=="function"&&((F=V.current)==null||F.on(B,ae))})}}function de(){return{player:V.current,video:M.current}}return h.createElement(h.Fragment,null,h.createElement(Le,null,h.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${w}/dist/cld-video-player.min.css`,rel:"stylesheet"})),h.createElement("div",{style:{width:"100%",aspectRatio:`${e.width} / ${e.height}`}},h.createElement("video",{ref:M,id:ne,className:W,width:f,height:m}),h.createElement(_e,{id:`cloudinary-videoplayer-${Math.floor(Math.random()*100)}`,src:`https://unpkg.com/cloudinary-video-player@${w}/dist/cld-video-player.min.js`,onLoad:le,onError:C=>console.error(`Failed to load Cloudinary Video Player: ${C.message}`)})))},oe=ve;function be(e){return I({...e,crop:e.crop||"fill",format:e.format||"jpg",gravity:e.gravity||"center",height:e.height||1254,width:e.width||2400,widthResize:e.width||1200})}export{q as CldImage,J as CldOgImage,te as CldUploadButton,b as CldUploadWidget,oe as CldVideoPlayer,R as cloudinaryLoader,I as getCldImageUrl,be as getCldOgImageUrl};
//# sourceMappingURL=index.mjs.map
"use strict";var he=Object.create;var G=Object.defineProperty;var Oe=Object.getOwnPropertyDescriptor;var Pe=Object.getOwnPropertyNames;var Ue=Object.getPrototypeOf,Ee=Object.prototype.hasOwnProperty;var we=(e,r)=>{for(var i in r)G(e,i,{get:r[i],enumerable:!0})},J=(e,r,i,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of Pe(r))!Ee.call(e,t)&&t!==i&&G(e,t,{get:()=>r[t],enumerable:!(n=Oe(r,t))||n.enumerable});return e};var u=(e,r,i)=>(i=e!=null?he(Ue(e)):{},J(r||!e||!e.__esModule?G(i,"default",{value:e,enumerable:!0}):i,e)),xe=e=>J(G({},"__esModule",{value:!0}),e);var De={};we(De,{CldImage:()=>$,CldOgImage:()=>X,CldUploadButton:()=>Y,CldUploadWidget:()=>T,CldVideoPlayer:()=>K,cloudinaryLoader:()=>M,getCldImageUrl:()=>O,getCldOgImageUrl:()=>ce});module.exports=xe(De);var E=u(require("react")),ie=u(require("next/image")),ne=require("@cloudinary-util/util"),ae=require("@cloudinary-util/url-loader");async function D(e){let{src:r}=e;try{await new Promise((i,n)=>{fetch(r).then(t=>{if(!t.ok){n(t);return}i(t)})})}catch(i){return i.status===423?await D(e):!1}return!0}var re=require("@cloudinary-util/url-loader");var Q=u(require("next/package.json"));var Z={name:"next-cloudinary",version:"4.15.0",main:"./dist/index.js",module:"./dist/index.mjs",types:"./dist/index.d.ts",source:"src/index.ts",scripts:{build:"tsup src/index.ts --dts",dev:"tsup src/index.ts --watch --dts",prepublishOnly:"cp ../README.md . && yarn build",postpublish:"rm ./README.md",test:"jest","test:app":'NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME="test" yarn build && cd tests/nextjs-app && yarn build'},dependencies:{"@cloudinary-util/url-loader":"^3.9.1","@cloudinary-util/util":"^2.2.1","@cloudinary/url-gen":"^1.10.1"},devDependencies:{"@babel/core":"^7.19.6","@babel/preset-env":"^7.19.4","@types/jest":"^29.2.0","@types/react":"^18.0.28","@types/react-dom":"^18.0.11","babel-jest":"^29.2.2",dotenv:"^16.0.3",jest:"^29.2.2","jest-environment-jsdom":"^29.2.2","ts-jest":"^29.0.3",tsup:"^6.6.3",typescript:"^4.9.4"},peerDependencies:{next:"^12 || ^13",react:"^17 || ^18"}};var ee="V",te=Z.version,oe=Q.default.version;function O(e,r,i){return(0,re.constructCloudinaryUrl)({options:e,config:Object.assign({cloud:{cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME}},r),analytics:Object.assign({sdkCode:ee,sdkSemver:te,techVersion:oe,feature:""},i)})}function M({loaderOptions:e,imageProps:r,cldOptions:i,cldConfig:n={}}){let t={...r,...i};if(t.width=typeof t.width=="string"?parseInt(t.width):t.width,t.height=typeof t.height=="string"?parseInt(t.height):t.height,typeof(e==null?void 0:e.width)=="number"&&typeof t.width=="number"&&e.width!==t.width){let d=e.width/t.width;t.widthResize=e.width,typeof t.height=="number"&&(t.heightResize=Math.round(t.height*d))}return O(t,n)}var Le=e=>{let r=["deliveryType","preserveTransformations"];ae.transformationPlugins.forEach(({props:o=[]})=>{o.forEach(l=>{if(r.includes(l))throw new Error(`Option ${l} already exists!`);r.push(l)})});let i={alt:e.alt,src:e.src};Object.keys(e).filter(o=>!r.includes(o)).forEach(o=>i[o]=e[o]);let n=Object.keys(i).map(o=>`${o}:${i[o]}`).join(";"),[t,d]=(0,E.useState)(n),s={};if(r.forEach(o=>{e[o]&&(s[o]=e[o]||void 0)}),e.preserveTransformations)try{let o=(0,ne.getTransformations)(e.src).map(l=>l.join(","));s.rawTransformations=[...o.flat(),...e.rawTransformations||[]]}catch(o){console.warn(`Failed to preserve transformations: ${o.message}`)}async function g(o){let l=!0;if(typeof e.onError=="function"){let U=e.onError(o);typeof U=="boolean"&&U===!1&&(l=!1)}else typeof e.onError=="boolean"&&e.onError===!1&&(l=!1);if(l===!1)return;let w=o.target;await D({src:w.src})&&d(`${n};${Date.now()}`)}let m=(0,E.useCallback)(g,[D,n]),a=ie.default;return"default"in a&&(a=a.default),E.default.createElement(a,{key:t,...i,loader:o=>M({loaderOptions:o,imageProps:i,cldOptions:s,cldConfig:e.config}),onError:m})},$=Le;var I=u(require("react")),le=u(require("next/head"));var ve="summary_large_image",be=({excludeTags:e=[],twitterTitle:r,keys:i={},...n})=>{let{alt:t}=n,d={...n,crop:n.crop||"fill",gravity:n.gravity||"center",height:n.height||1254,src:n.src,width:n.width||2400,widthResize:n.width||1200},s=typeof d.width=="string"?parseInt(d.width):d.width,g=typeof d.height=="string"?parseInt(d.height):d.height;typeof g=="number"&&typeof s=="number"&&(g=1200/s*g),s=1200;let m=O({...d,format:n.format||"jpg"}),a=O({...d,format:n.format||"webp"}),o={"og:image":"og-image","og:image:secure_url":"og-image-secureurl","og:image:width":"og-image-width","og:image:height":"og-image-height","og:image:alt":"og-image-alt","twitter:title":"twitter-title","twitter:card":"twitter-card","twitter:image":"twitter-image",...i};return I.default.createElement(le.default,null,I.default.createElement("meta",{key:o["og:image"],property:"og:image",content:m}),I.default.createElement("meta",{key:o["og:image:secure_url"],property:"og:image:secure_url",content:m}),I.default.createElement("meta",{key:o["og:image:width"],property:"og:image:width",content:`${s}`}),I.default.createElement("meta",{key:o["og:image:height"],property:"og:image:height",content:`${g}`}),t&&I.default.createElement("meta",{key:o["og:image:alt"],property:"og:image:alt",content:t}),!e.includes("twitter:title")&&I.default.createElement("meta",{key:o["twitter:title"],property:"twitter:title",content:r||" "}),I.default.createElement("meta",{key:o["twitter:card"],property:"twitter:card",content:ve}),I.default.createElement("meta",{key:o["twitter:image"],property:"twitter:image",content:a}))},X=be;var A=u(require("react"));var p=u(require("react")),se=u(require("next/script"));function de(e){return window&&"requestIdleCallback"in window?requestIdleCallback(e):setTimeout(()=>e(),1)}var Te=["success","display-changed"],Ae=({children:e,onClose:r,onError:i,onOpen:n,onUpload:t,options:d,signatureEndpoint:s,uploadPreset:g})=>{let m=(0,p.useRef)(),a=(0,p.useRef)(),o=!!s,[l,w]=(0,p.useState)(void 0),[y,U]=(0,p.useState)(void 0),[V,W]=(0,p.useState)(!0),x={cloudName:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,uploadPreset:g||process.env.NEXT_PUBLIC_CLOUDINARY_UPLOAD_PRESET,apiKey:process.env.NEXT_PUBLIC_CLOUDINARY_API_KEY,...d};o&&(x.uploadSignature=_,x.apiKey||console.warn("Missing dependency: Signed Upload requires an API key")),(0,p.useEffect)(()=>{if(typeof y=="undefined")return;let C=y.event==="success",h=y.event==="display-changed"&&y.info==="hidden";C&&typeof t=="function"&&t(y,a.current),h&&typeof r=="function"&&r(a.current)},[y]),(0,p.useEffect)(()=>{l&&typeof i=="function"&&i(l,a.current)},[l]);function N(){W(!1),m.current||(m.current=window.cloudinary),de(()=>{a.current||(a.current=L())})}function _(C,h){if(typeof s=="undefined")throw Error("Failed to generate signature: signatureEndpoint undefined.");fetch(s,{method:"POST",body:JSON.stringify({paramsToSign:h})}).then(f=>f.json()).then(({signature:f})=>{C(f)})}function L(){var C;return(C=m.current)==null?void 0:C.createUploadWidget(x,(h,f)=>{typeof h!="undefined"&&w(h),Te.includes(f==null?void 0:f.event)&&U(f)})}function j(){a.current||(a.current=L()),a==null||a.current.open(),typeof n=="function"&&n(a.current)}return p.default.createElement(p.default.Fragment,null,typeof e=="function"&&e({cloudinary:m.current,widget:a.current,open:j,results:y,error:l,isLoading:V}),p.default.createElement(se.default,{id:`cloudinary-uploadwidget-${Math.floor(Math.random()*100)}`,src:"https://widget.cloudinary.com/v2.0/global/all.js",onLoad:N,onError:C=>console.error(`Failed to load Cloudinary Upload Widget: ${C.message}`)}))},T=Ae;var Ne=({children:e,onClick:r,onError:i,onUpload:n,options:t,signatureEndpoint:d,uploadPreset:s,...g})=>A.default.createElement(A.default.Fragment,null,A.default.createElement(T,{onError:i,onUpload:n,options:t,signatureEndpoint:d,uploadPreset:s},({open:m,isLoading:a})=>{function o(l){l.preventDefault(),m(),typeof r=="function"&&r(l)}return A.default.createElement("button",{...g,onClick:o,disabled:a},e||"Upload")})),Y=Ne;var c=u(require("react")),pe=u(require("next/script")),me=u(require("next/head")),Ge=e=>{let r=(0,c.useRef)(Math.ceil(Math.random()*1e5)),{autoPlay:i="never",className:n,colors:t,controls:d=!0,fontFace:s,height:g,id:m,logo:a=!0,loop:o=!1,muted:l=!1,onDataLoad:w,onError:y,onMetadataLoad:U,onPause:V,onPlay:W,onEnded:x,src:N,transformation:_,version:L="1.9.4",quality:j="auto",width:C}=e,h=Array.isArray(_)?_:[_];h.unshift({quality:j});let f=(0,c.useRef)(),ge=(0,c.useRef)(),R=e.videoRef||ge,fe=(0,c.useRef)(),S=e.playerRef||fe,ue=m||`player-${N.replace("/","-")}-${r.current}`,k="cld-video-player cld-fluid";n&&(k=`${k} ${n}`);let H={error:y,loadeddata:w,loadedmetadata:U,pause:V,play:W,ended:x};function ye(P){let v=H[P.type];typeof v=="function"&&v(Ie())}function Ce(){if("cloudinary"in window){f.current=window.cloudinary;let P={};typeof a=="boolean"?P.showLogo=a:typeof a=="object"&&(P={...P,showLogo:!0,logoImageUrl:a.imageUrl,logoOnclickUrl:a.onClickUrl});let v={autoplayMode:i,cloud_name:process.env.NEXT_PUBLIC_CLOUDINARY_CLOUD_NAME,controls:d,fontFace:s||"",loop:o,muted:l,publicId:N,secure:!0,transformation:h,...P};typeof t=="object"&&(v.colors=t),S.current=f.current.videoPlayer(R.current,v),Object.keys(H).forEach(z=>{var q;typeof H[z]=="function"&&((q=S.current)==null||q.on(z,ye))})}}function Ie(){return{player:S.current,video:R.current}}return c.default.createElement(c.default.Fragment,null,c.default.createElement(me.default,null,c.default.createElement("link",{href:`https://unpkg.com/cloudinary-video-player@${L}/dist/cld-video-player.min.css`,rel:"stylesheet"})),c.default.createElement("div",{style:{width:"100%",aspectRatio:`${e.width} / ${e.height}`}},c.default.createElement("video",{ref:R,id:ue,className:k,width:C,height:g}),c.default.createElement(pe.default,{id:`cloudinary-videoplayer-${Math.floor(Math.random()*100)}`,src:`https://unpkg.com/cloudinary-video-player@${L}/dist/cld-video-player.min.js`,onLoad:Ce,onError:P=>console.error(`Failed to load Cloudinary Video Player: ${P.message}`)})))},K=Ge;function ce(e){return O({...e,crop:e.crop||"fill",format:e.format||"jpg",gravity:e.gravity||"center",height:e.height||1254,width:e.width||2400,widthResize:e.width||1200})}0&&(module.exports={CldImage,CldOgImage,CldUploadButton,CldUploadWidget,CldVideoPlayer,cloudinaryLoader,getCldImageUrl,getCldOgImageUrl});
//# sourceMappingURL=index.js.map